<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-10-06 Tue 18:33 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Servlet 是什么</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Jack Liu">
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/user.config.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">Servlet 是什么</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org400dcd0">Web 开发</a></li>
<li><a href="#org1b4375c">Servlet 入门</a></li>
<li><a href="#org7c1e8b3">Servlet 开发</a></li>
<li><a href="#org37de4ed">Servlet 是什么</a></li>
<li><a href="#org3b20181">与 Servlet 相关的接口和类</a></li>
</ul>
</div>
</div>

<div id="outline-container-org400dcd0" class="outline-2">
<h2 id="org400dcd0">Web 开发<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></h2>
<div class="outline-text-2" id="text-org400dcd0">
<p>
JavaEE 是什么？它并不是一个软件产品，更多的是一种软件架构和设计思想，它是在 JavaSE 的基础上，开发的一系列基于服务的组件、API 标准和通用架构。
</p>

<p>
JavaEE 最核心的组件就是基于 Servlet 标准的 Web 服务器，开发者编写的应用程序是基于 Servlet API 并运行在 Web 服务器内部的：
</p>

<img
src="/images/java/java-29.png"
width=""
height=""
style="float: right; margin-left: 16px;"
title=""
/>

<p>
此外，JavaEE 还有一系列的技术标准，目前最流行的基于 Spring 的轻量级 JavaEE 开发架构，使用最广泛的是 Servlet 和 JMS（Java Message Service，消息服务），以及一系列开源组件。
</p>

<p>
我们访问网站，使用 App 时，都是基于 Web 这种 Browser/Server 模式，简称 BS 架构，它的特点是，客户端只需要浏览器，应用程序的逻辑和数据都存储在服务器端。浏览器只需要请求服务器，获取 Web 页面，并把页面展示给用户即可。
</p>

<p>
在 Web 应用中，浏览器请求一个 URL ，服务器就把生成的 HTML 网页发送给浏览器，而浏览器和服务器之间的传输协议是 HTTP ，HTTP 协议是一个基于 TCP 协议上的请求-响应协议。
</p>

<p>
所为 <span class="underline">HTTP 编程</span> 是以客户端的身份去请求服务器资源，现在，我们需要以服务器的身份响应客户端请求，编写服务器程序来处理客户端请求通常就称之为 <span class="underline">Web 开发</span> 。
</p>

<p>
<b>那么，如何编写一个 HTTP Server 呢？</b>
</p>

<p>
一个 HTTP Server 本质上是一个 TCP 服务器，我们先用 TCP 编程的多线程实现一个服务器框架：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #F92672;">public</span> <span style="color: #F92672;">class</span> <span style="color: #66D9EF;">Server</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 2: </span>    <span style="color: #F92672;">public</span> <span style="color: #F92672;">static</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">main</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">String</span><span style="color: #A6E22E;">[]</span> <span style="color: #FD971F;">args</span><span style="color: #66D9EF;">)</span> <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">IOException</span> <span style="color: #66D9EF;">{</span>
<span class="linenr"> 3: </span>        <span style="color: #66D9EF;">ServerSocket</span> <span style="color: #FD971F;">ss</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">ServerSocket</span><span style="color: #A6E22E;">(</span>8080<span style="color: #A6E22E;">)</span>; <span style="color: #75715E;">// </span><span style="color: #75715E;">&#30417;&#21548;&#25351;&#23450;&#31471;&#21475;</span>
<span class="linenr"> 4: </span>        System.out.println<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"Server is running..."</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 5: </span>        <span style="color: #F92672;">for</span> <span style="color: #A6E22E;">(</span>;;<span style="color: #A6E22E;">)</span> <span style="color: #A6E22E;">{</span>
<span class="linenr"> 6: </span>            <span style="color: #66D9EF;">Socket</span> <span style="color: #FD971F;">sock</span> = ss.accept<span style="color: #E6DB74;">()</span>;
<span class="linenr"> 7: </span>            System.out.println<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">"Connected from "</span> + sock.getRemoteSocketAddress<span style="color: #FD971F;">()</span><span style="color: #E6DB74;">)</span>;
<span class="linenr"> 8: </span>            <span style="color: #66D9EF;">Thread</span> <span style="color: #FD971F;">t</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">Handler</span><span style="color: #E6DB74;">(</span>sock<span style="color: #E6DB74;">)</span>;
<span class="linenr"> 9: </span>            t.start<span style="color: #E6DB74;">()</span>;
<span class="linenr">10: </span>        <span style="color: #A6E22E;">}</span>
<span class="linenr">11: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">12: </span><span style="color: #AE81FF;">}</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #F92672;">class</span> <span style="color: #66D9EF;">Handler</span> <span style="color: #F92672;">extends</span> <span style="color: #66D9EF;">Thread</span> <span style="color: #AE81FF;">{</span>
<span class="linenr">15: </span>    <span style="color: #66D9EF;">Socket</span> <span style="color: #FD971F;">sock</span>;
<span class="linenr">16: </span>
<span class="linenr">17: </span>    <span style="color: #F92672;">public</span> <span style="color: #A6E22E;">Handler</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Socket</span> <span style="color: #FD971F;">sock</span><span style="color: #66D9EF;">)</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">18: </span>        <span style="color: #F92672;">this</span>.sock = sock;
<span class="linenr">19: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span>    <span style="color: #F92672;">public</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">run</span><span style="color: #66D9EF;">()</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">22: </span>        <span style="color: #F92672;">try</span> <span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">InputStream</span> <span style="color: #FD971F;">input</span> = <span style="color: #F92672;">this</span>.sock.getInputStream<span style="color: #E6DB74;">()</span><span style="color: #A6E22E;">)</span> <span style="color: #A6E22E;">{</span>
<span class="linenr">23: </span>            <span style="color: #F92672;">try</span> <span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">OutputStream</span> <span style="color: #FD971F;">output</span> = <span style="color: #F92672;">this</span>.sock.getOutputStream<span style="color: #FD971F;">()</span><span style="color: #E6DB74;">)</span> <span style="color: #E6DB74;">{</span>
<span class="linenr">24: </span>                handle<span style="color: #FD971F;">(</span>input, output<span style="color: #FD971F;">)</span>;
<span class="linenr">25: </span>            <span style="color: #E6DB74;">}</span>
<span class="linenr">26: </span>        <span style="color: #A6E22E;">}</span> <span style="color: #F92672;">catch</span> <span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">Exception</span> <span style="color: #FD971F;">e</span><span style="color: #A6E22E;">)</span> <span style="color: #A6E22E;">{</span>
<span class="linenr">27: </span>            <span style="color: #F92672;">try</span> <span style="color: #E6DB74;">{</span>
<span class="linenr">28: </span>                <span style="color: #F92672;">this</span>.sock.close<span style="color: #FD971F;">()</span>;
<span class="linenr">29: </span>            <span style="color: #E6DB74;">}</span> <span style="color: #F92672;">catch</span> <span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">IOException</span> <span style="color: #FD971F;">ioe</span><span style="color: #E6DB74;">)</span> <span style="color: #E6DB74;">{</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span>            <span style="color: #E6DB74;">}</span>
<span class="linenr">32: </span>            System.out.println<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">"Client disconnected."</span><span style="color: #E6DB74;">)</span>;
<span class="linenr">33: </span>        <span style="color: #A6E22E;">}</span>
<span class="linenr">34: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span>    <span style="color: #F92672;">private</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">handle</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">InputStream</span> <span style="color: #FD971F;">input</span>, <span style="color: #66D9EF;">OutputStream</span> <span style="color: #FD971F;">output</span><span style="color: #66D9EF;">)</span> <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">IOException</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">37: </span>        <span style="color: #66D9EF;">var</span> <span style="color: #FD971F;">reader</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">BufferedReader</span><span style="color: #A6E22E;">(</span><span style="color: #F92672;">new</span> <span style="color: #66D9EF;">InputStreamReader</span><span style="color: #E6DB74;">(</span>input, <span style="color: #AE81FF;">StrandardCharsets</span>.UTF_8<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">38: </span>        <span style="color: #66D9EF;">var</span> <span style="color: #FD971F;">writer</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">BufferedWriter</span><span style="color: #A6E22E;">(</span><span style="color: #F92672;">new</span> <span style="color: #66D9EF;">OutputStreamWriter</span><span style="color: #E6DB74;">(</span>output, <span style="color: #AE81FF;">StrandardCharsets</span>.UTF_8<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">39: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">TODO: &#22788;&#29702; HTTP &#35831;&#27714;</span>
<span class="linenr">40: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">...</span>
<span class="linenr">41: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">42: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
只需要在 <code>handle()</code> 方法中，用 Reader 读取 HTTP 请求，用 Writer 发送 HTTP 响应，即可实现一个最简单的 HTTP 服务器。编写代码如下：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #F92672;">private</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">handle</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">InputStream</span> <span style="color: #FD971F;">input</span>, <span style="color: #66D9EF;">OutputStream</span> <span style="color: #FD971F;">output</span><span style="color: #AE81FF;">)</span> <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">IOException</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 2: </span>    System.out.println<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">"Process new http request..."</span><span style="color: #66D9EF;">)</span>;
<span class="linenr"> 3: </span>    <span style="color: #66D9EF;">var</span> <span style="color: #FD971F;">reader</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">BufferedReader</span><span style="color: #66D9EF;">(</span><span style="color: #F92672;">new</span> <span style="color: #66D9EF;">InputStreamReader</span><span style="color: #A6E22E;">(</span>input, <span style="color: #AE81FF;">StandardCharsets</span>.UTF_8<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>;
<span class="linenr"> 4: </span>    <span style="color: #66D9EF;">var</span> <span style="color: #FD971F;">writer</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">BufferedWriter</span><span style="color: #66D9EF;">(</span><span style="color: #F92672;">new</span> <span style="color: #66D9EF;">OutputStreamWriter</span><span style="color: #A6E22E;">(</span>output, <span style="color: #AE81FF;">StandardCharsets</span>.UTF_8<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35835;&#21462; HTTP &#35831;&#27714;</span>
<span class="linenr"> 7: </span>    <span style="color: #66D9EF;">boolean</span> <span style="color: #FD971F;">requestOk</span> = <span style="color: #AE81FF;">false</span>;
<span class="linenr"> 8: </span>    <span style="color: #66D9EF;">String</span> <span style="color: #FD971F;">first</span> = reader.readLine<span style="color: #66D9EF;">()</span>;
<span class="linenr"> 9: </span>    <span style="color: #F92672;">if</span> <span style="color: #66D9EF;">(</span>first.startsWith<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"GET / HTTP/1."</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">10: </span>        requestOk = <span style="color: #AE81FF;">true</span>;
<span class="linenr">11: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">12: </span>    <span style="color: #F92672;">for</span> <span style="color: #66D9EF;">(</span>;;<span style="color: #66D9EF;">)</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">13: </span>        <span style="color: #66D9EF;">String</span> <span style="color: #FD971F;">header</span> = reader.readLine<span style="color: #A6E22E;">()</span>;
<span class="linenr">14: </span>        <span style="color: #F92672;">if</span> <span style="color: #A6E22E;">(</span>header.isEmpty<span style="color: #E6DB74;">()</span><span style="color: #A6E22E;">)</span> <span style="color: #A6E22E;">{</span> <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35835;&#21462;&#21040;&#31354;&#34892;&#26102;&#65292;HTTP Header &#35835;&#21462;&#23436;&#27605;</span>
<span class="linenr">15: </span>            <span style="color: #F92672;">break</span>;
<span class="linenr">16: </span>        <span style="color: #A6E22E;">}</span>
<span class="linenr">17: </span>        System.out.println<span style="color: #A6E22E;">(</span>header<span style="color: #A6E22E;">)</span>;
<span class="linenr">18: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">19: </span>    System.out.println<span style="color: #66D9EF;">(</span>requestOk ? <span style="color: #E6DB74;">"Response OK"</span> : <span style="color: #E6DB74;">"Response Error"</span><span style="color: #66D9EF;">)</span>;
<span class="linenr">20: </span>
<span class="linenr">21: </span>    <span style="color: #F92672;">if</span> <span style="color: #66D9EF;">(</span><span style="color: #E6DB74; font-weight: bold;">!</span>requestOk<span style="color: #66D9EF;">)</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">22: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#21457;&#36865;&#38169;&#35823;&#21709;&#24212;</span>
<span class="linenr">23: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"HTTP/1.0 404 Not Found\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">24: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"Content-Length: 0\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">25: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">26: </span>        writer.flush<span style="color: #A6E22E;">()</span>;
<span class="linenr">27: </span>    <span style="color: #66D9EF;">}</span> <span style="color: #F92672;">else</span> <span style="color: #66D9EF;">{</span>
<span class="linenr">28: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#21457;&#36865;&#25104;&#21151;&#21709;&#24212;</span>
<span class="linenr">29: </span>        <span style="color: #66D9EF;">String</span> <span style="color: #FD971F;">data</span> = <span style="color: #E6DB74;">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
<span class="linenr">30: </span>        <span style="color: #66D9EF;">int</span> <span style="color: #FD971F;">length</span> = data.getBytes<span style="color: #A6E22E;">(</span><span style="color: #AE81FF;">StandardCharsets</span>.UTF_8<span style="color: #A6E22E;">)</span>.length;
<span class="linenr">31: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"HTTP/1.0 200 OK\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">32: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"Connection: close\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">33: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"Content-Type: text/html\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">34: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"Content-Length: "</span> + length + <span style="color: #E6DB74;">"\r\n"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">35: </span>        writer.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"\r\n"</span><span style="color: #A6E22E;">)</span>;   <span style="color: #75715E;">// </span><span style="color: #75715E;">&#31354;&#34892;&#26631;&#35782; Header &#21644; Body &#30340;&#20998;&#38548;</span>
<span class="linenr">36: </span>        writer.write<span style="color: #A6E22E;">(</span>data<span style="color: #A6E22E;">)</span>;
<span class="linenr">37: </span>        writer.flush<span style="color: #A6E22E;">()</span>;
<span class="linenr">38: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">39: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
这里的核心代码是，先读取 HTTP 请求，这里我们只处理 <code>GET /</code> 的请求。当读取到空行时，表示已读到连续两个 <code>\r\n</code> ，说明请求结束，可以发送响应。发送响应的时候，首先发送响应代码 <code>HTTP/1.0 200 OK</code> 表示一个成功的 <code>200</code> 响应，使用 <code>HTTP/1.0</code> 协议，然后，依次发送 Header ，发送完 Header 后，再发送一个空行标识 Header 结束，紧接着发送 HTTP Body，在浏览器输入 <code>http://local.liaoxuefent.com/8080/</code> 就可以看到响应页面：
</p>

<img
src="/images/java/java-30.jpg"
width=""
height=""
style=""
title=""
/>

<p>
HTTP 目前有多个版本， <code>1.0</code> 是早期版本，浏览器每次建立 TCP 连接后，只发送一个 HTTP 请求并接收一个 HTTP 响应，然后就关闭 TCP 连接。
</p>

<p>
由于创建 TCP 连接本身就需要消耗一定的时间，因此，HTTP 1.1 允许浏览器和服务器在同一个 TCP 连接上反复发送、接收多个 HTTP 请求和响应，这样就大大提高了传输效率。
</p>

<p>
然而，HTTP 协议是一个请求-响应协议，它都是发送一个请求，然后接收一个响应。能不能一次性发送多个请求，然后再接收多个响应呢？
</p>

<p>
可以的！
</p>

<p>
HTTP 2.0 可以支持浏览器同时发出多个请求，但每个请求需要唯一标识，服务器可以不按请求的顺序返回多个响应，由浏览器自己把收到的响应和请求对应起来。可见，HTTP 2.0 进一步提高了效率，因为浏览器发出一个请求后，不必等待响应，就可以继续发下一个请求。
</p>

<p>
HTTP 3.0 为了进一步提高速度，将抛弃 TCP 协议，改为使用无需创建连接的 UDP 协议，目前仍然处于实验阶段。
</p>

<essay>
技术的进步是无止境的……
</essay>
</div>
</div>

<div id="outline-container-org1b4375c" class="outline-2">
<h2 id="org1b4375c">Servlet 入门</h2>
<div class="outline-text-2" id="text-org1b4375c">
<p>
在上一节中，可见，编写 HTTP 服务器其实是非常简单的，只需要先编写基于多线程的 TCP 服务，然后在一个 TCP 连接中读取 HTTP 请求，发送 HTTP 响应即可。
</p>

<p>
但是，要编写一个完善的 HTTP 服务器，以 HTTP/1.1 为例，需要考虑的包括：
</p>
<ul class="org-ul">
<li>识别正确和错误的 HTTP 请求；</li>
<li>识别正确和错误的 HTTP 头；</li>
<li>利用 TCP 连接；</li>
<li>利用线程；</li>
<li>IO 异常处理；</li>
<li>&#x2026;</li>
</ul>

<p>
BUT 这些基础工作需要耗费大量的时间，并且经过长时间测试才能稳定运行， <b>太低效了，太难了</b> 。
</p>

<p>
幸运的是，在 JavaEE 平台上，处理 TCP 连接，解析 HTTP 协议这些底层工作统统扔给现成的 Web 服务器去做，我们只需要把自己的应用程序跑在 Web 服务器上。
</p>

<essay>
交给可靠的机制去运行，省力又省心。
</essay>

<p>
JavaEE 是如何实现这一点的呢？
</p>

<p>
JavaEE 提供了 Servlet API，我们使用 Servlet API 编写自己的 Servlet 来处理 HTTP 请求，Web 服务器实现 Servlet API 接口，实现底层功能：
</p>

<img
src="/images/java/java-31.png"
width=""
height=""
style=""
title=""
/>

<p>
下面我们来实现一个最简单的 Servlet ：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #75715E;">// </span><span style="color: #75715E;">WebServlet &#27880;&#35299;&#34920;&#31034;&#36825;&#26159;&#19968;&#20010; Servlet &#65292;&#24182;&#26144;&#23556;&#21040;&#22320;&#22336; `/` &#65306;</span>
<span class="linenr"> 2: </span><span style="color: #AE81FF;">@WebServlet</span><span style="color: #AE81FF;">(</span>urlPatterns = <span style="color: #E6DB74;">"/"</span><span style="color: #AE81FF;">)</span>
<span class="linenr"> 3: </span><span style="color: #F92672;">public</span> <span style="color: #F92672;">class</span> <span style="color: #66D9EF;">HelloServlet</span> <span style="color: #F92672;">extends</span> <span style="color: #66D9EF;">HttpServlet</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 4: </span>    <span style="color: #F92672;">protected</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">doGet</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">HttpServletRequest</span> <span style="color: #FD971F;">req</span>, <span style="color: #66D9EF;">HttpServletResponse</span> <span style="color: #FD971F;">resp</span><span style="color: #66D9EF;">)</span>
<span class="linenr"> 5: </span>        <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">ServletException</span>, <span style="color: #66D9EF;">IOException</span> <span style="color: #66D9EF;">{</span>
<span class="linenr"> 6: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35774;&#32622;&#21709;&#24212;&#31867;&#22411;&#65306;</span>
<span class="linenr"> 7: </span>        resp.setContentType<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"text/html"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 8: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#33719;&#21462;&#36755;&#20986;&#27969;&#65306;</span>
<span class="linenr"> 9: </span>        <span style="color: #66D9EF;">PrintWriter</span> <span style="color: #FD971F;">pw</span> = resp.getWriter<span style="color: #A6E22E;">()</span>;
<span class="linenr">10: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#20889;&#20837;&#21709;&#24212;&#65306;</span>
<span class="linenr">11: </span>        pw.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"&lt;h1&gt;Hello, world!&lt;/h1&gt;"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">12: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#26368;&#21518;&#19981;&#35201;&#24536;&#35760; flush &#24378;&#21046;&#36755;&#20986;&#65306;</span>
<span class="linenr">13: </span>        pw.flush<span style="color: #A6E22E;">()</span>;
<span class="linenr">14: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">15: </span><span style="color: #AE81FF;">}</span>
<span class="linenr">16: </span>
</pre>
</div>

<p>
<b>一个 Servlet 总是继承自 <code>HttpServlet</code> ，然后覆写 <code>doGet()</code> 或 <code>doPost()</code> 方法</b> 。
</p>

<p>
注意到 <code>doGet()</code> 方法传入了 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code> 两个对象，分别代表 HTTP 请求和响应。
</p>

<p>
我们使用 Servlet API 时，并不直接与底层 TCP 交互，也不需要解析 HTTP 协议，因为 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code> 就已经封装好了请求和响应。以发送响应为例，我们只需要设置正确的响应类型，然后获取 <code>PrintWriter</code> ，写入响应即可。
</p>

<p>
<b>Servlet API 是什么？</b>
</p>

<p>
Servlet API 是一个 jar 包，我们需要通过 Maven 来引入它，才能正常编译。通过 Maven 构建后会得到一个 <code>.war</code> 格式的文件，那么， <b>如何运行这个 <code>war</code> 文件呢</b> ？
</p>

<p>
普通的 Java 程序是通过启动 JVM ，然后执行 <code>main()</code> 方法开始运行。但是 Web 应用程序有所不同，我们无法直接运行 <code>war</code> 文件，必须先启动 Web 服务器，再由 Web 服务器加载我们编写的 HelloServlet ，这样就可以让我们编写的 HelloServlet 处理浏览器发送的请求。
</p>

<p>
<b>那么，Servlet API是谁提供的呢？</b>
</p>

<p>
是由支持 Servlet API 的 Web 服务器提供的！常用的服务器有：
</p>
<ul class="org-ul">
<li>Tomcat ：由 Apache 开发的开源免费服务器；</li>
<li>Jetty ：由 Eclipse 开发的开源免费服务器；</li>
<li>GlassFish ：一个开源的全功能 JavaEE 服务器；</li>
<li>WebLogic ：Oracle 的商用服务器；</li>
<li>WebSphere ：IBM 的调用服务器。</li>
</ul>

<p>
无论使用哪个服务器，只要它支持相同版本的 Servlet API ，我们在引版本上开发构建的 <code>war</code> 包都可以在上面运行。
</p>

<p>
我们通常选用最广泛的开源免费的 Tomcat 服务器。
</p>

<p>
实际上，类似 Tomcat 这样的服务器也是 Java 编写的，启动 Tomcat 服务器实际上是启动 Java 虚拟机，执行 Tomcat 的 <code>main()</code> 方法，然后由 Tomcat 负责加载我们的 <code>.war</code> 文件，并创建一个我们编写的 HelloServlet 实例，最后以多线程的模式来处理 HTTP 请求。例如，Tomcat 服务器收到的请求路径是 <code>/</code> 时，就转发到 HelloServlet 并传入 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code> 现个对象。
</p>

<p>
由上可知，我们编写的 Servlet 并不是直接运行，而是由 Web 服务器加载后创建实例运行，所以，类似于 Tomcat 这样的 Web 服务器也称为 <span class="underline">Servlet 容器</span> 。
</p>

<p>
在 Servlet 容器中运行的 Servlet 具有如下特点：
</p>
<ul class="org-ul">
<li>无法在代码中直接通过 new 创建 Servlet 实例，必须由 Servlet 容器自动创建 Servlet 实例；</li>
<li>Servlet 容器只会给每个 Servlet 类创建唯一实例；</li>
<li>Servlet 容器会使用多线程执行 <code>doGet()</code> 或 <code>doPost()</code> 方法。</li>
</ul>

<p>
*注：在 Servlet 中定义的实例变量会被多个线程同时访问，要注意线程安全。正确编写 Servlet ，要清晰理解 Java 的多线程模型，需要同步访问的必须同步。
</p>
</div>
</div>

<div id="outline-container-org7c1e8b3" class="outline-2">
<h2 id="org7c1e8b3">Servlet 开发</h2>
<div class="outline-text-2" id="text-org7c1e8b3">
<p>
通常，一个完整的 Web 应用程序的开发流程如下：
</p>
<ol class="org-ol">
<li>编写 Servlet ；</li>
<li>打包为 war 文件；</li>
<li>复制到 Tomcat 的 webapps 目录下；</li>
<li>启动 Tomcat 。</li>
</ol>

<p>
这个过程同样很繁琐（开发者都是“懒虫”啦），而且如果我们想在 IDE 中断点调试，还需要打开 Tomcat 的远程调试端口并且连接上去。
</p>

<p>
但是，许多初学者经常卡在如何在 IDE 中启动 Tomcat 并加载 webapp，更不要说断点调试了……
</p>

<p>
Tomcat 实际上也是一个 Java 程序，我们看看 Tomcat 的启动流程：
</p>
<ol class="org-ol">
<li>启动 JVM 并执行 Tomcat 的 <code>main()</code> 方法；</li>
<li>加载 <code>.war</code> 文件并初始化 Servlet ；</li>
<li>正常服务。</li>
</ol>

<p>
那么，启动 Tomcat 无非就是设置好 classpath 并执行 Tomcat 某个 jar 包的 <code>main()</code> 方法，我们完全可以把 Tomcat 的 jar 包全部引入进来，然后自己编写一个 <code>main()</code> 方法，先启动 Tomcat ，会后让它加载我们的 webapp 就可以了。
</p>

<p>
我们新建一个 <code>web-servlet-embedded</code> 工程，编写 <code>pom.xml</code> 如下：
</p>

<div class="org-src-container">
<pre class="src src-xml"><span class="linenr"> 1: </span>&lt;<span style="color: #A6E22E;">project</span> <span style="color: #F92672;">xmlns</span>=<span style="color: #E6DB74;">"http://maven.apache.org/POM/4.0.0"</span>
<span class="linenr"> 2: </span>         <span style="color: #F92672;">xmlns</span>:<span style="color: #FD971F;">xsi</span>=<span style="color: #E6DB74;">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span class="linenr"> 3: </span>         <span style="color: #F92672;">xsi</span>:<span style="color: #FD971F;">schemaLocation</span>=<span style="color: #E6DB74;">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;
<span class="linenr"> 4: </span>         &lt;<span style="color: #A6E22E;">modelVersion</span>&gt;4.0.0&lt;/<span style="color: #A6E22E;">modelVersion</span>&gt;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>         &lt;<span style="color: #A6E22E;">groupId</span>&gt;com.itranswarp.leanjava&lt;/<span style="color: #A6E22E;">groupId</span>&gt;
<span class="linenr"> 7: </span>         &lt;<span style="color: #A6E22E;">artifactId</span>&gt;web-servlet-embedded&lt;/<span style="color: #A6E22E;">artifactId</span>&gt;
<span class="linenr"> 8: </span>         &lt;<span style="color: #A6E22E;">version</span>&gt;1.0-SNAPSHOT&lt;/<span style="color: #A6E22E;">version</span>&gt;
<span class="linenr"> 9: </span>         &lt;<span style="color: #A6E22E;">packaging</span>&gt;war&lt;/<span style="color: #A6E22E;">packaging</span>&gt;
<span class="linenr">10: </span>
<span class="linenr">11: </span>         &lt;<span style="color: #A6E22E;">properties</span>&gt;
<span class="linenr">12: </span>           &lt;<span style="color: #A6E22E;">project.build.sourceEncoding</span>&gt;UTF-8&lt;/<span style="color: #A6E22E;">project.build.sourceEncoding</span>&gt;
<span class="linenr">13: </span>           &lt;<span style="color: #A6E22E;">project.reporting.outputEncoding</span>&gt;UTF-8&lt;/<span style="color: #A6E22E;">project.reporting.outputEncoding</span>&gt;
<span class="linenr">14: </span>           &lt;<span style="color: #A6E22E;">maven.compiler.source</span>&gt;11&lt;/<span style="color: #A6E22E;">maven.compiler.source</span>&gt;
<span class="linenr">15: </span>           &lt;<span style="color: #A6E22E;">maven.compiler.target</span>&gt;11&lt;/<span style="color: #A6E22E;">maven.compiler.target</span>&gt;
<span class="linenr">16: </span>           &lt;<span style="color: #A6E22E;">java.version</span>&gt;11&lt;/<span style="color: #A6E22E;">java.version</span>&gt;
<span class="linenr">17: </span>           &lt;<span style="color: #A6E22E;">tomcat.version</span>&gt;9.0.26&lt;/<span style="color: #A6E22E;">tomcat.version</span>&gt;
<span class="linenr">18: </span>         &lt;/<span style="color: #A6E22E;">properties</span>&gt;
<span class="linenr">19: </span>
<span class="linenr">20: </span>         &lt;<span style="color: #A6E22E;">dependencies</span>&gt;
<span class="linenr">21: </span>           &lt;<span style="color: #A6E22E;">dependency</span>&gt;
<span class="linenr">22: </span>             &lt;<span style="color: #A6E22E;">groupId</span>&gt;org.apache.tomcat.embed&lt;/<span style="color: #A6E22E;">groupId</span>&gt;
<span class="linenr">23: </span>             &lt;<span style="color: #A6E22E;">artifactId</span>&gt;tomcat-embed-core&lt;/<span style="color: #A6E22E;">artifactId</span>&gt;
<span class="linenr">24: </span>             &lt;<span style="color: #A6E22E;">version</span>&gt;${tomcat.version}&lt;/<span style="color: #A6E22E;">version</span>&gt;
<span class="linenr">25: </span>             &lt;<span style="color: #A6E22E;">scope</span>&gt;provided&lt;/<span style="color: #A6E22E;">scope</span>&gt;
<span class="linenr">26: </span>           &lt;/<span style="color: #A6E22E;">dependency</span>&gt;
<span class="linenr">27: </span>           &lt;<span style="color: #A6E22E;">dependency</span>&gt;
<span class="linenr">28: </span>             &lt;<span style="color: #A6E22E;">groupId</span>&gt;org.apache.tomcat.embed&lt;/<span style="color: #A6E22E;">groupId</span>&gt;
<span class="linenr">29: </span>             &lt;<span style="color: #A6E22E;">artifactId</span>&gt;tomcat-embed-jasper&lt;/<span style="color: #A6E22E;">artifactId</span>&gt;
<span class="linenr">30: </span>             &lt;<span style="color: #A6E22E;">version</span>&gt;${tomcat.version}&lt;/<span style="color: #A6E22E;">version</span>&gt;
<span class="linenr">31: </span>             &lt;<span style="color: #A6E22E;">scope</span>&gt;provided&lt;/<span style="color: #A6E22E;">scope</span>&gt;
<span class="linenr">32: </span>           &lt;/<span style="color: #A6E22E;">dependency</span>&gt;
<span class="linenr">33: </span>         &lt;/<span style="color: #A6E22E;">dependencies</span>&gt;
<span class="linenr">34: </span>&lt;/<span style="color: #A6E22E;">project</span>&gt;
</pre>
</div>

<p>
其中， <code>&lt;packaging&gt;</code> 类型仍然为 <code>war</code> ，引入依赖 <code>tomcat-embed-core</code> 和 <code>tomcat-embed-jasper</code> ，引入的 Tomcat 版本为 <code>&lt;tomcat.version&gt;</code> 为 <code>9.0.26</code> 。
</p>

<p>
不必引入 Servlet API，因为引入 Tomcat 依赖后自动引入了 Servlet API 。因此，我们可以正常编写 Servlet 如下：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #AE81FF;">@WebServlet</span><span style="color: #AE81FF;">(</span>urlPatterns = <span style="color: #E6DB74;">"/"</span><span style="color: #AE81FF;">)</span>
<span class="linenr"> 2: </span><span style="color: #F92672;">public</span> <span style="color: #F92672;">class</span> <span style="color: #66D9EF;">HelloServlet</span> <span style="color: #F92672;">extends</span> <span style="color: #66D9EF;">HttpServlet</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #F92672;">protected</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">doGet</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">HttpServletRequest</span> <span style="color: #FD971F;">req</span>, <span style="color: #66D9EF;">HttpServletResponse</span> <span style="color: #FD971F;">resp</span><span style="color: #66D9EF;">)</span>
<span class="linenr"> 4: </span>        <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">ServletException</span>, <span style="color: #66D9EF;">IOException</span> <span style="color: #66D9EF;">{</span>
<span class="linenr"> 5: </span>        resp.setContentType<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"text/html"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 6: </span>        <span style="color: #66D9EF;">String</span> <span style="color: #FD971F;">name</span> = req.getParameter<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"name"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 7: </span>        <span style="color: #F92672;">if</span> <span style="color: #A6E22E;">(</span>name == <span style="color: #AE81FF;">null</span><span style="color: #A6E22E;">)</span> <span style="color: #A6E22E;">{</span>
<span class="linenr"> 8: </span>            name = <span style="color: #E6DB74;">"world"</span>;
<span class="linenr"> 9: </span>        <span style="color: #A6E22E;">}</span>
<span class="linenr">10: </span>        <span style="color: #66D9EF;">PrintWriter</span> <span style="color: #FD971F;">pw</span> = resp.getWriter<span style="color: #A6E22E;">()</span>;
<span class="linenr">11: </span>        pw.write<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">"&lt;h1&gt;Hello, "</span> + name + <span style="color: #E6DB74;">"&lt;/h1&gt;"</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">12: </span>        pw.flush<span style="color: #A6E22E;">()</span>;
<span class="linenr">13: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">14: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
然后，我们编写一个 <code>main()</code> 方法，启动 Tomcat 服务器：
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #F92672;">public</span> <span style="color: #F92672;">class</span> <span style="color: #66D9EF;">Main</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 2: </span>    <span style="color: #F92672;">public</span> <span style="color: #F92672;">static</span> <span style="color: #66D9EF;">void</span> <span style="color: #A6E22E;">main</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">String</span><span style="color: #A6E22E;">[]</span> <span style="color: #FD971F;">args</span><span style="color: #66D9EF;">)</span> <span style="color: #F92672;">throws</span> <span style="color: #66D9EF;">Exception</span> <span style="color: #66D9EF;">{</span>
<span class="linenr"> 3: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#21551;&#21160; Tomcat &#65306;</span>
<span class="linenr"> 4: </span>        <span style="color: #66D9EF;">Tomcat</span> <span style="color: #FD971F;">tomcat</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">Tomcat</span><span style="color: #A6E22E;">()</span>;
<span class="linenr"> 5: </span>        tomcat.setPort<span style="color: #A6E22E;">(</span>Integer.getInteger<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">"port"</span>, 8080<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 6: </span>        tomcat.getConnectory<span style="color: #A6E22E;">()</span>;
<span class="linenr"> 7: </span>        <span style="color: #75715E;">// </span><span style="color: #75715E;">&#21019;&#24314; webapp &#65306;</span>
<span class="linenr"> 8: </span>        <span style="color: #66D9EF;">Context</span> <span style="color: #FD971F;">ctx</span> = tomcat.addWebApp<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">""</span>, <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">File</span><span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">"src/main/webapp"</span><span style="color: #E6DB74;">)</span>,getAbsolutePath<span style="color: #E6DB74;">()</span><span style="color: #A6E22E;">)</span>;
<span class="linenr"> 9: </span>        <span style="color: #66D9EF;">WebResourceRoot</span> <span style="color: #FD971F;">resources</span> = <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">StandardRoot</span><span style="color: #A6E22E;">(</span>ctx<span style="color: #A6E22E;">)</span>;
<span class="linenr">10: </span>        resources.addPreResources<span style="color: #A6E22E;">(</span><span style="color: #F92672;">new</span> <span style="color: #66D9EF;">DirResourceSet</span><span style="color: #E6DB74;">(</span>resources, <span style="color: #E6DB74;">"/WEB-INF/classes"</span>, <span style="color: #F92672;">new</span> <span style="color: #66D9EF;">File</span><span style="color: #FD971F;">(</span><span style="color: #E6DB74;">"target/classes"</span><span style="color: #FD971F;">)</span>.getAbsolutePath<span style="color: #FD971F;">()</span>, <span style="color: #E6DB74;">"/"</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>;
<span class="linenr">11: </span>        ctx.setResources<span style="color: #A6E22E;">(</span>resources<span style="color: #A6E22E;">)</span>;
<span class="linenr">12: </span>        tomcat.start<span style="color: #A6E22E;">()</span>;
<span class="linenr">13: </span>        tomcat.getServer<span style="color: #A6E22E;">()</span>.await<span style="color: #A6E22E;">()</span>;
<span class="linenr">14: </span>    <span style="color: #66D9EF;">}</span>
<span class="linenr">15: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
如此，我们直接运行 <code>main()</code> 方法，即可启动嵌入式 Tomcat 服务器，
</p>

<p>
后，通过预设的 <code>tomcat.addWebapp("", new File("src/main/webapp")</code> ，Tomcat 会自动加载当前工程作为根 webapp，可直接在浏览器访问 <a href="http://localhost:8080/%EF%BC%9A">http://localhost:8080/：</a>
</p>

<img
src="/images/java/java-32.png"
width=""
height=""
style=""
title=""
/>

<p>
通过 <code>main()</code> 方法启动 Tomcat 服务器并加载我们自己的 webapp 有如下好处：
</p>
<ol class="org-ol">
<li>启动简单，无需下载 Tomcat 或安装任何 IDE 插件；</li>
<li>高度方便，可在 IDE 中使用断点调试；</li>
<li>使用 Maven 创建 war 包后，也可以正常部署到独立的 Tomcat 服务器中。</li>
</ol>

<essay>
看吧，你需要做一些基础的东西，才能在此基础上理方便地处理事物。
</essay>

<p>
对 SpringBoot 有所了解的童鞋可能知道，SpringBoot 也支持在 <code>main()</code> 方法中一行代码直接启动 Tomcat，并且还能方便地更换成 Jetty 等其他服务器，它的启动方式和我们介绍的是基本一样的。
</p>

<essay>
幸运地是，许多繁琐的事情都已经有了比较成熟的解决方式，但是为什么采取这些方式，以及它们的优缺点还是需要了然于胸的。
</essay>
</div>
</div>

<div id="outline-container-org37de4ed" class="outline-2">
<h2 id="org37de4ed">Servlet 是什么</h2>
<div class="outline-text-2" id="text-org37de4ed">
<p>
好的，下面我们就来具体认识一下 Servlet 是什么。
</p>

<img
src="/images/java/java-33.jpg"
width="200"
height=""
style="float: left;margin-right: 10px;"
title=""
/>

<p>
Servlet 是 Server Applet 的简称，译为“服务器端小程序”。它是 Java 的一套技术标准，规定了如何使用 Java 来开发动态网站。换句话说，Java 可以用来开发网站后台，但是要提前定义好一套规范，并编写基础类库，这就是 Servlet 所做的事情。
</p>

<p>
Java Servlet 可以使用所有的 Java API ，Java 能做的事情，Servlet 都能做。
</p>

<p>
#+BEGIN<sub>QUOTE</sub>
Servlet 只是古老的 CGI 技术的替代品，然而直接使用 Servlet 开发还是很麻烦，所以 Java 后来又对 Servlet 进行了升级，推出了 JSP 技术。本质上，JSP 只是对 Servlet 加了一层壳，JSP 经过编译后还是 Servlet 。
#+END<sub>QUOTE</sub>。
</p>

<essay>
程序嘛，最终都是要变为二进制的 0 和 1 ，所以，一切不过都是抽象，一层一层的抽象罢了。
</essay>

<p>
Servlet 是 Java Servlet 的简称，是使用 Java 语言编写的运行在服务器端的程序，具有独立平台和协议的特性，主要功能在于交互式地浏览和生成数据，生成动态 Web 内容。
</p>

<p>
<b>通常来说，Servlet 是指所有实现了 Servlet 接口的类。</b>
</p>

<ul class="org-ul">
<li>Servlet 主要用于处理客户端传来的 HTTP 请求，并返回一个响应，它能够处理的请求有 <code>doGet()</code> 和 <code>doPost()</code> 等；</li>
<li>Servlet 由 Servlet 容器提供，所谓 Servlet 容器就是指提供了 Servlet 功能的服务器（如 Tomcat）；</li>
<li>Servlet 容器会将 Servlet 动态加载到服务器上，然后通过 HTTP 请求和 HTTP 响应与客户端进行交互。</li>
</ul>

<p>
Servlet 应用程序的体系结构如下：
</p>

<img
src="/images/java/java-34.gif"
width=""
height=""
style=""
title=""
/>

<p>
如上图中，Servlet 的请求首先会被 HTTP 服务器（如 Apache、Nginx）接收，HTTP 服务器只负责静态 HTML 页面的解析，而 Servlet 的请求会转交给 Servlet 容器，Servlet 容器会根据 <code>web.xml</code> 文件中的映射关系，调用相应的 Servlet ，Servlet 再将处理的结果返回给 Servlet 容器，并通过 HTTP 服务器将响应传输给客户端。
</p>
</div>
</div>

<div id="outline-container-org3b20181" class="outline-2">
<h2 id="org3b20181">与 Servlet 相关的接口和类</h2>
<div class="outline-text-2" id="text-org3b20181">
<p>
SUN 公司提供了一系列的接口和类用于 Servlet 技术的开发（缅怀一下 SUN 公司吧），其中最重要的接口是 <code>javax.servlet.Servlet</code> 。在 Servlet 接口中定义了 5 个抽象方法，如下表：
</p>
<table>
<caption class="t-above"><span class="table-number">Table 1:</span> Servlet 接口的抽象方法</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法声明</th>
<th scope="col" class="org-left">功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>void init(ServletConfig config)</code></td>
<td class="org-left">容器在创建好 Servlet 对象后，就会调用此方法。该方法接收一个 ServletConfig 类型的参数，Servlet 容器通过该参数向 Servlet 传递初始化配置信息</td>
</tr>

<tr>
<td class="org-left"><code>ServletConfig getServletConfig()</code></td>
<td class="org-left">用于获取 Servlet 对象的配置信息，返回 Servlet 的 <code>ServletConfig</code> 对象</td>
</tr>

<tr>
<td class="org-left"><code>String getServletInfo()</code></td>
<td class="org-left">返回一个字符串，其中包含关于 Servlet 的信息，如作者、版本和版权等信息</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>void service(ServletRequest request, ServletResponse response)</code></td>
<td class="org-left">负责响应用户的请求，当容器接收到客户端访问 Servlet 对象的请求时，就会调用此方法。</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">容器会构造一个表示客户端请求信息的 <code>ServletRequest</code> 对象和一个用于响应客户端的 <code>ServletResponse</code> 对象作为参数传递给 <code>service()</code> 方法。</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">在 <code>service()</code> 方法中，可以通过 <code>ServletRequest</code> 对象得到客户端的相关信息和请求信息，在对请求进行处理后，调用 <code>ServletResponse</code> 对象的方法设置响应信息</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>void destroy()</code></td>
<td class="org-left">负责释放 Servlet 对象占用的资源，当服务器关闭或者 Servlet 对象被移除时，Servlet 对象会被销毁，容器会调用此方法</td>
</tr>
</tbody>
</table>

<p>
在表中，列举了 Servlet 接口中的五个方法，其中 <code>init()、service()</code> 和 <code>destroy()</code> 方法可以表现 Servlet 的生命周期，它们会在某个特定的时刻被调用。
</p>

<p>
针对 Servlet 的接口，SUN 公司提供了现个默认的接口实现类： <code>GenericServlet</code> 和 <code>HttpServlet</code> 。其中：
</p>
<ul class="org-ul">
<li><code>GenericServlet</code> 是一个抽象类，该类为 Servlet 接口提供了部分实现，它并没有实现 HTTP 请求处理；</li>
<li><code>HttpServlet</code> 是 <code>GenericServlet</code> 的子类，它继承了 <code>GenericServlet</code> 的所有方法，并且为 HTTP 请求中的 GET 和 POST 等类型提供了具体的操作方法。</li>
</ul>

<p>
*注：通常情况下，编写的 Servlet 类都继承自 <code>HttpServlet</code> ，在开发中使用的也是 <code>HttpServlet</code> 对象。
</p>

<table>
<caption class="t-above"><span class="table-number">Table 2:</span> HttpServlet 类的常用方法</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法声明</th>
<th scope="col" class="org-left">功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>protected void doGet(HttpServletRequest req, HttpServletResponse resp)</code></td>
<td class="org-left">用于处理 GET 类型的 HTTP 请求的方法</td>
</tr>

<tr>
<td class="org-left"><code>protected void doPost(HttpServletRequest req, HttpServletResponse resp)</code></td>
<td class="org-left">用于处理 POST 类型的 HTTP 请求的方法</td>
</tr>
</tbody>
</table>

<p>
HttpServlet 主要有两大功能，具体如下：
</p>
<ul class="org-ul">
<li>根据用户请求方式的不同，定义相应的 <code>doXxx()</code> 方法处理用户请求，例如，与 GET 请求方式对应的 <code>doGet()</code> 方法，与 POST 方式对应的 <code>doPost()</code> 方法；</li>
<li>通过 <code>service()</code> 方法将 HTTP 请求和响应分别强转为 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code> 类型的对象。</li>
</ul>

<p>
需要注意的是，由于 HttpServlet 类在重写的 <code>service()</code> 方法，为每一种 HTTP 请求方式都定义了对应的 <code>doXxx()</code> 方法，因此，当定义的类的继承 HttpServlet 后，只需要根据请求方式重写对应的 <code>doXxx()</code> 方法即可，而不需要重写 <code>service()</code> 方法。
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304265903570978">https://www.liaoxuefeng.com/wiki/1252599548343744/1304265903570978</a>
</p></div></div>

</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Date: 2020-10-06 Tue 14:08</p>
<p class="author">Author: Jack Liu</p>
<p class="date">Created: 2020-10-06 Tue 18:33</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
